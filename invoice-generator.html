<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Invoice Generator - OmniTools</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- THEME --- */
        :root { 
            --bg: #020617; 
            --panel: #0f172a; 
            --text: #f8fafc; 
            --muted: #94a3b8; 
            --border: #1e293b; 
            --theme-color: #6366f1;
            --paper-width: 210mm; /* Default A4 */
            --print-scale: 1;     /* Default Scale */
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* NAVBAR */
        nav { padding: 20px 5%; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .back-btn { color: var(--muted); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .back-btn:hover { color: white; }
        .brand-badge { background: rgba(99, 102, 241, 0.1); color: #818cf8; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; }

        .container { max-width: 1000px; margin: 40px auto; padding: 20px; }
        
        /* CONTROLS BAR */
        .controls { 
            display: flex; gap: 15px; margin-bottom: 20px; background: var(--panel); padding: 15px; border-radius: 12px; border: 1px solid var(--border); align-items: center; justify-content: space-between; flex-wrap: wrap;
        }
        .control-group { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .select-currency { background: #020617; border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; cursor: pointer; }
        
        /* SCALE & SIZE CONTROLS */
        .size-control { display: flex; align-items: center; gap: 8px; background: #020617; padding: 5px 10px; border-radius: 8px; border: 1px solid #334155; }
        .size-label { font-size: 0.8rem; color: var(--muted); font-weight: 600; }
        input[type="range"] { accent-color: var(--theme-color); cursor: pointer; }

        /* COLOR PICKER */
        .color-label { font-size: 0.85rem; color: var(--muted); font-weight: 600; margin-right: 5px; }
        input[type="color"] { width: 40px; height: 40px; border: none; background: none; cursor: pointer; }

        .btn { padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; display: flex; align-items: center; gap: 8px; transition: 0.2s; color: white; }
        .btn-print { background: var(--theme-color); }
        .btn-print:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-clear { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        /* PAPER STYLE (Dynamic Size) */
        .paper-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            overflow: auto;
            padding: 20px;
            background: #0f172a;
            border-radius: 12px;
            border: 1px solid #1e293b;
        }
        
        .invoice-paper { 
            background: white; 
            color: #0f172a; 
            /* DYNAMIC WIDTH VARIABLE */
            width: var(--paper-width); 
            min-height: 297mm;
            padding: 50px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
            position: relative; 
            transition: width 0.3s ease;
        }

        /* HEADER */
        .header-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 50px; }
        
        .logo-box {
            width: 150px; height: 100px; background: #f1f5f9; border: 2px dashed #cbd5e1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative;
        }
        .logo-box img { width: 100%; height: 100%; object-fit: contain; display: none; }
        .logo-placeholder { font-size: 0.8rem; color: #64748b; text-align: center; pointer-events: none; }
        
        .title-group { text-align: right; }
        .invoice-title { font-size: 3rem; font-weight: 800; color: var(--theme-color); letter-spacing: -1px; line-height: 1; }

        /* INPUTS */
        input.clean { 
            background: transparent; border: 1px solid transparent; padding: 5px; border-radius: 4px; font-family: inherit; transition: 0.2s; width: 100%; color: #0f172a;
        }
        input.clean:hover, input.clean:focus { background: #f8fafc; border-color: #e2e8f0; outline: none; }
        input.bold { font-weight: 700; }
        input.right { text-align: right; }
        
        /* EXTRA FIELDS */
        .extra-field-row { display: flex; align-items: center; gap: 5px; }
        .remove-field { color: #ef4444; cursor: pointer; font-size: 0.8rem; opacity: 0; }
        .extra-field-row:hover .remove-field { opacity: 1; }
        .add-info-btn { font-size: 0.8rem; color: var(--theme-color); cursor: pointer; margin-top: 5px; display: inline-block; font-weight: 600; text-decoration: none; }

        /* DETAILS GRID */
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px; }
        .section-label { font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }

        /* TABLE */
        .items-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .items-table th { text-align: left; padding: 12px 10px; background: var(--theme-color); color: white; font-size: 0.8rem; text-transform: uppercase; border-radius: 4px 4px 0 0; }
        .items-table td { padding: 10px; border-bottom: 1px solid #e2e8f0; }
        
        .add-row-btn { background: transparent; color: var(--theme-color); border: 1px dashed var(--theme-color); padding: 10px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; }
        .add-row-btn:hover { background: #f8fafc; }

        /* TOTALS */
        .totals-section { display: flex; justify-content: flex-end; margin-top: 20px; }
        .totals-box { width: 300px; }
        .calc-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f1f5f9; }
        .calc-row.grand { border-bottom: none; border-top: 2px solid var(--theme-color); margin-top: 10px; padding-top: 15px; font-size: 1.3rem; font-weight: 800; color: var(--theme-color); }

        .delete-btn { color: #ef4444; background: none; border: none; cursor: pointer; opacity: 0; transition: 0.2s; }
        tr:hover .delete-btn { opacity: 1; }
        
        /* FOOTER */
        .footer-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 40px; margin-top: 60px; border-top: 1px solid #e2e8f0; padding-top: 30px; }
        .bank-details { background: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid var(--theme-color); }
        .bank-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 10px; color: #334155; }
        
        /* SIGNATURE */
        .signature-area { text-align: center; margin-top: 20px; position: relative; }
        .sig-box { width: 100%; height: 60px; border-bottom: 2px solid #e2e8f0; margin-bottom: 10px; display: flex; align-items: flex-end; justify-content: center; cursor: pointer; transition: 0.2s; }
        .sig-box:hover { background: #f1f5f9; border-color: var(--muted); }
        .sig-img { max-height: 55px; max-width: 100%; display: none; }
        .sig-placeholder { font-size: 0.7rem; color: #cbd5e1; margin-bottom: 5px; }

        /* --- FLEXIBLE PRINTING CSS --- */
        @media print {
            @page { margin: 10mm; } /* Allow browser to handle size */
            
            body { 
                background: white; 
                -webkit-print-color-adjust: exact; 
                zoom: var(--print-scale); /* USER SELECTED ZOOM */
            }

            nav, .controls, .add-row-btn, .delete-btn, .remove-field, .add-info-btn { 
                display: none !important; 
            }

            .container, .paper-wrapper { 
                width: 100%; max-width: 100%; margin: 0; padding: 0; border: none; background: white;
            }

            .invoice-paper { 
                /* Allow paper to fit width of chosen page */
                width: 100% !important; 
                max-width: 100% !important;
                margin: 0; padding: 20px; border: none; box-shadow: none; min-height: auto;
            }

            input { border: none !important; background: transparent !important; padding: 0 !important; }
            input::placeholder { color: transparent; }
            .logo-placeholder, .sig-placeholder { display: none !important; }
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Back to Tools</a>
    <span class="brand-badge">ULTIMATE EDITION</span>
</nav>

<div class="container">
    <div class="controls">
        <div class="control-group">
            <span class="color-label">Theme:</span>
            <input type="color" id="themePicker" value="#6366f1" onchange="changeTheme(this.value)">
            
            <div class="size-control">
                <span class="size-label">Paper:</span>
                <select class="select-currency" style="padding:5px;" onchange="changePaperWidth(this.value)">
                    <option value="210mm">A4 (Standard)</option>
                    <option value="148mm">A5 (Half/Compact)</option>
                    <option value="216mm">Letter (US)</option>
                </select>
            </div>

            <div class="size-control">
                <span class="size-label">Print Scale:</span>
                <input type="range" min="0.5" max="1" step="0.1" value="1" oninput="changeScale(this.value)" title="Zoom In/Out for Print">
            </div>

            <select class="select-currency" id="currency" onchange="updateCurrency()">
                <option value="$">USD ($)</option>
                <option value="€">EUR (€)</option>
                <option value="£">GBP (£)</option>
                <option value="₹">INR (₹)</option>
            </select>
            <button class="btn btn-clear" onclick="clearData()"><i class="fa-solid fa-rotate-left"></i> Reset</button>
        </div>
        <button class="btn btn-print" onclick="window.print()"><i class="fa-solid fa-print"></i> Save PDF</button>
    </div>

    <div class="paper-wrapper">
        <div class="invoice-paper" id="invoice">
            
            <div class="header-grid">
                <div>
                    <input type="file" id="logoInput" accept="image/*" style="display:none" onchange="loadLogo(event)">
                    <div class="logo-box" onclick="document.getElementById('logoInput').click()">
                        <div class="logo-placeholder" id="logoText">+ Upload Logo</div>
                        <img id="logoImg" alt="Logo">
                    </div>
                </div>
                <div class="title-group">
                    <div class="invoice-title">INVOICE</div>
                    <div style="display:flex; justify-content:flex-end; align-items:center;">
                        <span style="color:#64748b; margin-right:5px;">#</span>
                        <input type="text" class="clean right" value="INV-001" style="width:100px; font-weight:600; font-size:1.1rem;">
                    </div>
                </div>
            </div>

            <div class="details-grid">
                <div>
                    <div class="section-label">From</div>
                    <input type="text" class="clean bold" placeholder="Your Company Name" id="fromName" oninput="saveData()">
                    <input type="text" class="clean" placeholder="Your Email" id="fromEmail" oninput="saveData()">
                    <input type="text" class="clean" placeholder="Your Address" id="fromAddress" oninput="saveData()">
                    <div id="fromExtras"></div>
                    <div class="add-info-btn" onclick="addExtra('fromExtras')">+ Add Phone / VAT</div>
                </div>

                <div style="text-align:right;">
                    <div class="section-label">Bill To</div>
                    <input type="text" class="clean bold right" placeholder="Client Name" id="toName" oninput="saveData()">
                    <input type="text" class="clean right" placeholder="Client Email" id="toEmail" oninput="saveData()">
                    <div id="toExtras"></div>
                    <div class="add-info-btn" onclick="addExtra('toExtras', true)">+ Add Phone / VAT</div>

                    <div style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <div>
                            <div class="section-label">Date</div>
                            <input type="date" class="clean right" id="dateIssued" oninput="saveData()">
                        </div>
                        <div>
                            <div class="section-label">Due Date</div>
                            <input type="date" class="clean right" id="dateDue" oninput="saveData()">
                        </div>
                    </div>
                </div>
            </div>

            <table class="items-table">
                <thead>
                    <tr>
                        <th width="50%">Description</th>
                        <th width="15%">Rate</th>
                        <th width="10%">Qty</th>
                        <th width="20%" style="text-align:right;">Amount</th>
                        <th width="5%"></th> 
                    </tr>
                </thead>
                <tbody id="lineItems"></tbody>
            </table>
            <button class="add-row-btn" onclick="addRow()"><i class="fa-solid fa-plus"></i> Add Line Item</button>

            <div class="totals-section">
                <div class="totals-box">
                    <div class="calc-row"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
                    <div class="calc-row" style="align-items:center;">
                        <span>Tax (%) <input type="number" class="clean" value="10" id="taxRate" style="width:50px; text-align:center; background:#f8fafc; border:1px solid #e2e8f0;" oninput="calc()"></span>
                        <span id="taxAmount">$0.00</span>
                    </div>
                    <div class="calc-row grand"><span>Total</span><span id="grandTotal">$0.00</span></div>
                </div>
            </div>

            <div class="footer-grid">
                <div class="bank-details">
                    <div class="bank-title">Payment Info</div>
                    <input type="text" class="clean" placeholder="Bank Name: " style="font-weight:600;">
                    <input type="text" class="clean" placeholder="Account Name: ">
                    <input type="text" class="clean" placeholder="Account Number / IBAN: ">
                    <input type="text" class="clean" placeholder="SWIFT / Routing Code: ">
                </div>
                <div class="signature-area">
                    <input type="file" id="sigInput" accept="image/*" style="display:none" onchange="loadSignature(event)">
                    <div class="sig-box" onclick="document.getElementById('sigInput').click()">
                        <div class="sig-placeholder" id="sigText">(Click to Upload Signature)</div>
                        <img id="sigImg" class="sig-img" alt="Signature">
                    </div>
                    <div style="font-size:0.8rem; color:#64748b;">Authorized Signature</div>
                </div>
            </div>
            <div style="margin-top:30px; text-align:center; font-size:0.9rem; color:#64748b;">
                <input type="text" class="clean" value="Thank you for your business!" style="text-align:center;">
            </div>
        </div>
    </div>
</div>

<script>
    let currency = "$";

    window.onload = function() {
        document.getElementById('dateIssued').valueAsDate = new Date();
        loadData();
        calc();
    };

    function changeTheme(color) { document.documentElement.style.setProperty('--theme-color', color); }
    
    // SCALE & PAPER SIZE LOGIC
    function changePaperWidth(width) {
        document.documentElement.style.setProperty('--paper-width', width);
    }
    function changeScale(val) {
        document.documentElement.style.setProperty('--print-scale', val);
    }

    function addExtra(containerId, isRight = false) {
        const container = document.getElementById(containerId);
        const div = document.createElement('div');
        div.className = "extra-field-row";
        const alignStyle = isRight ? "text-align:right;" : "";
        div.innerHTML = `<input type="text" class="clean" style="${alignStyle}" placeholder="Phone / VAT / Website..."><i class="fa-solid fa-xmark remove-field" onclick="this.parentElement.remove()"></i>`;
        container.appendChild(div);
    }

    function updateCurrency() { currency = document.getElementById('currency').value; calc(); }

    function addRow(desc='', rate=0, qty=1) {
        const tbody = document.getElementById('lineItems');
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input type="text" class="clean" placeholder="Item description..." value="${desc}" oninput="calc()"></td><td><input type="number" class="clean" placeholder="0" value="${rate}" oninput="calc()"></td><td><input type="number" class="clean" placeholder="1" value="${qty}" oninput="calc()"></td><td class="amount-col" style="text-align:right; font-weight:600;">0.00</td><td style="text-align:center;"><button class="delete-btn" onclick="this.closest('tr').remove(); calc();"><i class="fa-solid fa-xmark"></i></button></td>`;
        tbody.appendChild(tr);
        calc();
    }

    function calc() {
        let subtotal = 0;
        const rows = document.querySelectorAll('#lineItems tr');
        rows.forEach(row => {
            const inputs = row.querySelectorAll('input');
            const rate = parseFloat(inputs[1].value) || 0;
            const qty = parseFloat(inputs[2].value) || 0;
            const total = rate * qty;
            row.querySelector('.amount-col').innerText = currency + total.toFixed(2);
            subtotal += total;
        });
        const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
        const taxVal = subtotal * (taxRate / 100);
        const grand = subtotal + taxVal;
        document.getElementById('subtotal').innerText = currency + subtotal.toFixed(2);
        document.getElementById('taxAmount').innerText = currency + taxVal.toFixed(2);
        document.getElementById('grandTotal').innerText = currency + grand.toFixed(2);
        saveData();
    }

    function loadLogo(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('logoImg');
                img.src = e.target.result;
                img.style.display = 'block';
                document.getElementById('logoText').style.display = 'none';
                localStorage.setItem('omniLogo', e.target.result);
            }
            reader.readAsDataURL(file);
        }
    }

    function loadSignature(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('sigImg');
                img.src = e.target.result;
                img.style.display = 'block';
                document.getElementById('sigText').style.display = 'none';
                localStorage.setItem('omniSig', e.target.result);
            }
            reader.readAsDataURL(file);
        }
    }

    function saveData() {
        const data = {
            fromName: document.getElementById('fromName').value,
            toName: document.getElementById('toName').value,
            items: [] 
        };
        document.querySelectorAll('#lineItems tr').forEach(row => {
            const inputs = row.querySelectorAll('input');
            data.items.push({ desc: inputs[0].value, rate: inputs[1].value, qty: inputs[2].value });
        });
        localStorage.setItem('omniInvoice', JSON.stringify(data));
    }

    function loadData() {
        const data = JSON.parse(localStorage.getItem('omniInvoice'));
        const savedLogo = localStorage.getItem('omniLogo');
        const savedSig = localStorage.getItem('omniSig');
        if(savedLogo) {
            const img = document.getElementById('logoImg');
            img.src = savedLogo;
            img.style.display = 'block';
            document.getElementById('logoText').style.display = 'none';
        }
        if(savedSig) {
            const img = document.getElementById('sigImg');
            img.src = savedSig;
            img.style.display = 'block';
            document.getElementById('sigText').style.display = 'none';
        }
        if(data && data.items) {
            document.getElementById('fromName').value = data.fromName || "";
            document.getElementById('toName').value = data.toName || "";
            data.items.forEach(item => addRow(item.desc, item.rate, item.qty));
        } else {
            addRow();
        }
    }

    function clearData() {
        if(confirm("Delete all data?")) {
            localStorage.removeItem('omniInvoice');
            localStorage.removeItem('omniLogo');
            localStorage.removeItem('omniSig');
            location.reload();
        }
    }
</script>
    <script src="database.js"></script>


</body>

</html>

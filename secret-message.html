<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Note | The Secret Messenger</title>
    <meta name="description" content="Send secret messages to your crush. Anti-screenshot technology.">
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- COSMIC THEME --- */
        :root { 
            --bg: #0b0f19;
            --panel: #151b2b;
            --text: #f8fafc;
            --muted: #94a3b8;
            --gold: #fbbf24;
            --pink: #ec4899; 
            --gradient: linear-gradient(135deg, #fbbf24 0%, #ec4899 100%);
            --whatsapp: #25D366;
            --border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; overflow-x: hidden; }

        .stars {
            position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1;
            background-image: radial-gradient(white 1px, transparent 1px);
            background-size: 50px 50px; opacity: 0.1;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        nav { display: flex; align-items: center; margin-bottom: 30px; padding-top: 20px; }
        .back-btn { color: var(--muted); text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .back-btn:hover { color: var(--gold); }

        .card { 
            background: var(--panel); border: var(--border); border-radius: 24px; padding: 40px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); text-align: center; overflow: hidden; position: relative;
        }

        h1 { font-size: 2.2rem; font-weight: 800; margin-bottom: 10px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: var(--muted); margin-bottom: 30px; font-size: 1.1rem; }

        /* TABS */
        .tab-container {
            display: inline-flex; gap: 10px; background: #0b0f19; padding: 5px; border-radius: 50px;
            margin-bottom: 30px; border: 1px solid #334155;
        }
        .tab-btn {
            background: transparent; border: none; color: var(--muted); padding: 12px 30px;
            border-radius: 40px; cursor: pointer; font-weight: 600; font-family: 'Outfit', sans-serif; transition: 0.3s;
        }
        .tab-btn.active { background: var(--gradient); color: #fff; box-shadow: 0 5px 15px rgba(236, 72, 153, 0.3); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }

        /* INPUTS */
        .input-group { text-align: left; margin-bottom: 25px; }
        label { display: block; color: var(--muted); margin-bottom: 10px; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;}
        
        input[type="file"], textarea {
            width: 100%; padding: 15px; background: #0b0f19; border: 1px solid #334155; 
            color: white; border-radius: 12px; font-family: 'Outfit', sans-serif; font-size: 1rem; transition: 0.3s;
        }
        textarea { height: 120px; resize: none; line-height: 1.5; }
        input[type="file"]::file-selector-button { background: #1e293b; color: white; border: none; padding: 8px 15px; border-radius: 6px; margin-right: 15px; cursor: pointer; }
        input:focus, textarea:focus { border-color: var(--pink); box-shadow: 0 0 20px rgba(236, 72, 153, 0.2); }

        /* MAGIC BUTTONS */
        .magic-btn {
            background: var(--gradient); border: none; padding: 16px; border-radius: 12px;
            color: white; font-weight: 800; font-size: 1.1rem; cursor: pointer; transition: 0.3s;
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.3); width: 100%;
            display: flex; align-items: center; justify-content: center; gap: 10px; text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .magic-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(236, 72, 153, 0.5); }
        .whatsapp-btn { background: var(--whatsapp); margin-top: 15px; display: none; }

        /* SUSPENSE REVEAL AREA */
        .reveal-overlay {
            background: rgba(0,0,0,0.4); padding: 30px; border-radius: 16px; 
            border: 1px solid var(--pink); margin-top: 20px; text-align: center;
            display: none; animation: fadeIn 0.5s ease;
        }
        
        .blur-content { filter: blur(8px); user-select: none; transition: filter 2s ease; }
        .unblurred { filter: blur(0px); }
        .lock-icon { font-size: 3rem; color: var(--pink); margin-bottom: 10px; animation: pulse 2s infinite; }
        
        .reveal-btn {
            background: transparent; border: 2px solid var(--pink); color: var(--pink);
            padding: 10px 25px; border-radius: 30px; font-weight: 700; cursor: pointer;
            margin-top: 15px; transition: 0.3s;
        }
        .reveal-btn:hover { background: var(--pink); color: white; }

        .result-text { 
            font-family: 'Courier New', monospace; color: var(--gold); font-size: 1.3rem; 
            font-weight: 700; word-break: break-all; line-height: 1.5; min-height: 50px;
        }

        .panels { position: relative; min-height: 300px; }
        .panel { display: none; animation: fadeIn 0.4s ease; }
        .panel.active { display: block; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .warning-text { 
            font-size: 0.9rem; color: #fca5a5; margin-top: 20px; line-height: 1.5; 
            background: rgba(127, 29, 29, 0.2); padding: 15px; border-radius: 12px; border: 1px solid rgba(248, 113, 113, 0.2);
            text-align: left;
        }

        /* INSTRUCTION STEPS STYLING */
        .steps-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; text-align: left;
        }
        .step-item { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .step-icon { font-size: 1.5rem; color: var(--gold); margin-bottom: 10px; }
        .step-title { font-weight: 700; color: white; margin-bottom: 5px; font-size: 1rem; }
        .step-desc { font-size: 0.85rem; color: var(--muted); line-height: 1.4; }
        
        @media(max-width: 600px) { .steps-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="stars"></div>

<audio id="lockSound" src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-click-900.mp3"></audio>
<audio id="revealSound" src="https://assets.mixkit.co/sfx/preview/mixkit-magical-shine-reveal-68.mp3"></audio>

<div class="container">
    <nav>
        <a href="index.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</a>
    </nav>

    <div class="card">
        <h1>Ghost Note</h1>
        <p class="subtitle">Send secret messages to your crush. <br>They must unlock it to read it.</p>

        <div class="tab-container">
            <button class="tab-btn active" onclick="switchTab('encode')"><i class="fa-solid fa-heart"></i> Hide Secret</button>
            <button class="tab-btn" onclick="switchTab('decode')"><i class="fa-solid fa-key"></i> Reveal Secret</button>
        </div>

        <div class="panels">
            <div id="encode" class="panel active">
                <div class="input-group">
                    <label>1. Upload A Cute Photo</label>
                    <input type="file" id="upload-enc" accept="image/*">
                </div>

                <div class="input-group">
                    <label>2. The Secret Confession</label>
                    <textarea id="secret-text" placeholder="I've been wanting to tell you this for a long time..."></textarea>
                </div>

                <button class="magic-btn" onclick="encode()">
                    <i class="fa-solid fa-lock"></i> Encrypt & Download
                </button>

                <button id="copyCaptionBtn" class="magic-btn whatsapp-btn" onclick="copyCaption()">
                    <i class="fa-regular fa-copy"></i> Copy "Crush" Caption
                </button>

                <div class="warning-text">
                    <i class="fa-solid fa-heart-crack"></i> 
                    <strong>WARNING:</strong> If using WhatsApp, you MUST send as a <strong>"Document"</strong> ðŸ“Ž. If you send as a normal photo, the magic won't work.
                </div>
            </div>

            <div id="decode" class="panel">
                <div class="input-group">
                    <label>Upload The "Ghost Note"</label>
                    <input type="file" id="upload-dec" accept="image/*">
                </div>

                <button class="magic-btn" style="background: #334155; color: white;" onclick="decode()">
                    <i class="fa-solid fa-wand-magic-sparkles"></i> Analyze Image
                </button>

                <div id="suspenseBox" class="reveal-overlay">
                    <div id="lockedState">
                        <i class="fa-solid fa-lock lock-icon"></i>
                        <h3 style="color:white; margin-bottom:5px;">Secret Found!</h3>
                        <p style="color:var(--muted); font-size:0.9rem;">This message is locked.</p>
                        <button class="reveal-btn" onclick="startReveal()">TAP TO DECRYPT</button>
                    </div>

                    <div id="unlockedState" style="display:none;">
                        <div id="finalMessage" class="result-text blur-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-top:60px; padding-top:30px; border-top:1px solid #334155;">
            <h2 style="color:white; margin-bottom:10px; font-size: 1.5rem;">How the Magic Works</h2>
            
            <div class="steps-grid">
                <div class="step-item">
                    <div class="step-icon"><i class="fa-solid fa-user-secret"></i></div>
                    <div class="step-title">1. Create Ghost Note</div>
                    <div class="step-desc">Upload any photo and type your secret. Our tool hides the text inside the pixels (Steganography).</div>
                </div>
                
                <div class="step-item">
                    <div class="step-icon"><i class="fa-solid fa-share-nodes"></i></div>
                    <div class="step-title">2. Send as File</div>
                    <div class="step-desc">Send the downloaded image to your crush. <strong>Important:</strong> Send as a "Document/File" so quality isn't lost.</div>
                </div>

                <div class="step-item">
                    <div class="step-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                    <div class="step-title">3. The Big Reveal</div>
                    <div class="step-desc">They upload the photo here. They tap "Decrypt," wait for the scramble effect, and the secret is revealed!</div>
                </div>
            </div>
        </div>

    </div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    // --- SETUP ---
    let hiddenMessage = ""; 

    function switchTab(mode) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.getElementById(mode).classList.add('active');
    }

    function playSound(id) {
        const audio = document.getElementById(id);
        if(audio) { audio.currentTime = 0; audio.play().catch(e => {}); }
    }

    // --- ENCODE ---
    function encode() {
        const fileInput = document.getElementById('upload-enc');
        const text = document.getElementById('secret-text').value;
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        if (fileInput.files.length === 0 || text === "") return alert("Please add an image and text!");

        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;

                let binaryText = "";
                for (let i = 0; i < text.length; i++) {
                    binaryText += text.charCodeAt(i).toString(2).padStart(8, '0');
                }
                binaryText += "00000000"; 

                if (binaryText.length > data.length / 4) return alert("Text too long!");

                for (let i = 0; i < binaryText.length; i++) {
                    let pixelIndex = i * 4; 
                    data[pixelIndex] = (data[pixelIndex] & 254) | parseInt(binaryText[i]);
                }

                ctx.putImageData(imgData, 0, 0);
                playSound('lockSound');

                const link = document.createElement('a');
                link.download = `ghost_note_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();

                document.getElementById('copyCaptionBtn').style.display = 'flex';
                alert("Encrypted! Now click 'Copy Caption'!");
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    // --- CAPTION FOR CRUSH ---
    function copyCaption() {
        const url = window.location.href;
        const caption = `I can't say this out loud... so I hid it in this photo ðŸ¤«\n\n1. Save this file.\n2. Go to: ${url}\n3. Upload to read my confession.\n\n(Send as Document ðŸ“Ž)`;
        navigator.clipboard.writeText(caption).then(() => alert("Caption Copied! Go send it!"));
    }

    // --- DECODE (PART 1: FIND) ---
    function decode() {
        const fileInput = document.getElementById('upload-dec');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        if (fileInput.files.length === 0) return alert("Upload image first!");

        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imgData.data;

                let binaryText = "";
                let decodedString = "";

                for (let i = 0; i < data.length; i += 4) {
                    binaryText += (data[i] & 1); 
                    if (binaryText.length === 8) {
                        const charCode = parseInt(binaryText, 2);
                        if (charCode === 0) break; 
                        decodedString += String.fromCharCode(charCode);
                        binaryText = "";
                    }
                }

                if(decodedString.length > 0 && /[\x20-\x7E]/.test(decodedString)) {
                    hiddenMessage = decodedString;
                    document.getElementById('suspenseBox').style.display = 'block';
                    document.getElementById('lockedState').style.display = 'block';
                    document.getElementById('unlockedState').style.display = 'none';
                    playSound('lockSound'); 
                } else {
                    alert("No secret message found. Did you upload the original PNG?");
                }
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    // --- REVEAL (PART 2: SUSPENSE) ---
    function startReveal() {
        document.getElementById('lockedState').style.display = 'none';
        document.getElementById('unlockedState').style.display = 'block';
        
        const msgEl = document.getElementById('finalMessage');
        msgEl.innerText = generateRandomString(hiddenMessage.length); 
        msgEl.classList.remove('unblurred'); 

        playSound('revealSound');
        if(navigator.vibrate) navigator.vibrate([100, 50, 100]);

        let iterations = 0;
        const interval = setInterval(() => {
            msgEl.innerText = msgEl.innerText.split("")
                .map((letter, index) => {
                    if(index < iterations) return hiddenMessage[index];
                    return "ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*".charAt(Math.floor(Math.random() * 26));
                })
                .join("");

            if(iterations >= hiddenMessage.length) { 
                clearInterval(interval);
                msgEl.innerText = hiddenMessage;
                msgEl.classList.add('unblurred');
                fireConfetti();
            }
            iterations += 1/3; 
        }, 30);
    }

    function generateRandomString(length) {
        let result = '';
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
        for (let i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return result;
    }

    function fireConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#fbbf24', '#ec4899', '#ffffff']
        });
    }

    // Safety Check
    document.getElementById('upload-dec').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && file.type !== "image/png") {
            alert("âš ï¸ Warning: This file is a " + file.type.split('/')[1].toUpperCase() + ". Secrets are hidden in PNGs.");
        }
    });
</script>
<script src="database.js"></script>
</body>
</html>
